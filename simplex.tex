\section{Симплекс-метод}
\label{sec:simplex}

Симплекс-метод позволяет решать задачи линейного программирования,
заключающиеся в минимизации целевого линейного функционала при
заданных линейных ограничениях. Основной идеей симплекс-метода
является перебор вершин выпуклого многогранника в многомерном
пространстве.

\subsection{Алгоритм симплекс-метода}

Приведём описание общей схемы метода. Более подробное изложение
предложено, например, в \cite{taha05}.

Рассмотрим следующую \neword{задачу линейного программирования}:
\begin{equation}
  \label{eq:lp-problem-form-initial}
  \begin{cases}
    f(x) = \suml_{i=1}^n{\! c_i x_i} + c_{n+1} \to \min \\
    Ax = b,\, \underset{m×n}{A} = (a_{ij}),\rank{A} = m,\,b \in \set{E}^n \\
    x_i \geq 0,\, i = \overline{1, n}
  \end{cases}
\end{equation}
Как видим, она состоит в поиске таких неотрицательных значений
$x_i$, что достигается минимум линейной функции $f(x)$ при выполнении
$n$ линейных ограничений на набор $x_i$, которые задают
\neword{допустимую область решений} задачи.

\begin{rem}
  \label{rem:slack}
  Рассмотрение задачи с ограничениями лишь типа равенств не
  ограничивает общности рассуждений. Действительно, ограничение типа
  неравенства со знаком ``$\leq$''
  \begin{equation*}
    \suml_{i=1}^n a_{ij} x_i \leq b_j
  \end{equation*}
  может быть сведено к ограничению типа равенства путём добавления
  дополнительной неотрицательной переменной $s_k$, называемой
  \neword{остаточной}:
  \begin{equation*}
    \suml_{i=1}^n a_{ij} x_i + s_k = b_j
  \end{equation*}

  В случае знака ``$\geq$'' ограничение типа неравенства
  \begin{equation*}
    \suml_{i=1}^n a_{ij} x_i \geq b_j
  \end{equation*}
  приводится к равенству путем вычитания \neword{избыточной
    переменной}:
  \begin{equation*}
    \suml_{i=1}^n a_{ij} x_i - s_k = b_j
  \end{equation*}

  В обоих случаях условие $s_k \geq 0$ добавляется к набору
  ограничений исходной задачи.
\end{rem}

\begin{rem}
  В силу теоремы \ref{th:convex-set} и замечаний
  \ref{rem:lin-f-convex}, \ref{rem:slack}, множество ограничений
  задачи \eqref{eq:lp-problem-form-initial} является выпуклым.
  Известно, что локальный минимум \eqref{eq:lp-problem-form-initial}
  расположен хотя бы в одной из «вершин» допустимой области и может
  быть найден путем целенаправленного перебора\footnote{Геометрическая
    интерпретация простой задачи линейного программирования
    представлена на рис. \ref{fig:simplex-method} в
    разделе \ref{sec:simplex-geom}.} \emph{конечного} их числа.
\end{rem}

Пусть исходная задача может быть приведена к следующему виду:
\begin{equation}
  \label{eq:lp-problem-form}
  \begin{cases}
    f(x) = -{\!\!\!\!\suml_{i={m+1}}^n{\!\!\!\!\Delta_{i} x_i}} + \hat{c}_{n+1} \to \min \\
    x_j + \!\! \suml_{i=m+1}^n {\!\!\!\!\alpha_{ji} x_i} = \beta_j,\,
    \beta_j \geq 0, j = \overline{1, m},\\
    x_i \geq 0,\, i = \overline{1, n}
  \end{cases}
\end{equation}

\begin{dfn}
  В задаче \eqref{eq:lp-problem-form} переменные $x_1, \dotsc, x_m$,
  которым соответствуют единичные столбцы в новой матрице
  коэффициентов ограничений, называются \neword{базисными}, а
  $x_{m+1}, \dotsc, x_n$ — \neword{свободными}.
\end{dfn}

\begin{dfn}
  Решение задачи \eqref{eq:lp-problem-form} при нулевых свободных
  переменных называется \neword{базисным решением}. Если при этом все
  переменные принимают неотрицательные значения, решение называется
  \neword{допустимым}, а в противном случае — \neword{недопустимым}.
\end{dfn}

Итерационный алгоритм симплекс-метода для поиска оптимального решения
перебирает ограниченное число допустимых базисных решений. В ходе
работы алгоритма на каждой итерации определённая переменная
исключается из состава базисных, а другая, наоборот, вводится в их
число, что соответствует уменьшению значения целевой функции с помощью
изменения значения одной из свободных переменных.

Для формулировки алгоритма удобно на каждой итерации использовать
следующее матричное представление задачи:

\begin{equation}
  \label{eq:lp-matrix}
  \begin{bmatrix}
     & \bar{x}_1 & \bar{x}_2 & \hdots & \bar{x}_m & \bar{x}_{m+1} & \hdots & \bar{x}_n & \\
    \bar{x}_1 & 1 & 0 & \hdots & 0  & \bar{\alpha}_{1,{m+1}} & \hdots & \bar{\alpha}_{1,n} & \bar{\beta}_1 \\
    \bar{x}_2 & 0 & 1 & & \vdots & \bar{\alpha}_{2,{m+1}} & \hdots & \bar{\alpha}_{2,n} & \bar{\beta}_2 \\
    \vdots & \vdots & &\vspace{2pt}\ddots  & 0 & \vdots & \ddots & \vdots & \vdots \\
    \bar{x}_m & 0 & \hdots & 0 & 1 & \bar{\alpha}_{m,{m+1}} & \hdots & \bar{\alpha}_{m,n} & \bar{\beta}_m \\
    f & 0 & \hdots & 0 & 0 & \bar{\Delta}_{m+1} & \hdots & \bar{\Delta}_n & \hat{\bar{c}}_{n+1}
  \end{bmatrix}
\end{equation}
\begin{rem}
  Поскольку наборы базисных и свободных переменных меняются с каждой
  итерацией, в данной формулировке с помощью
  $\bar{x}_1,\dotsc,\bar{x}_m$ и $\bar{x}_{m+1}, \dotsc, \bar{x}_n$
  обозначены базисные и свободные переменные \emph{на текущей
    итерации}. Аналогичные обозначения используются и для элементов
  матрицы \eqref{eq:lp-matrix}. На практике подобное
  переупорядочивание переменных обычно не используется.
\end{rem}

Приведём последовательность действий, выполняемых для решения задачи
симплекс-методом.
\begin{steps}
\item Если все коэффициенты $\bar{\Delta}_{m+1}, \dotsc,
  \bar{\Delta}_n$ неположительны, то найдено оптимальное решение
  $\bar{x}_1 = \bar{\beta}_1, \dotsc, \bar{x}_m = \bar{\beta}_m,
  \bar{x}_{m+1} = \bar{x}_n = 0$. Если найдётся $\bar{\Delta}_s > 0$
  такое, что в соответствующем столбце матрицы \eqref{eq:lp-matrix}
  все коэффициенты $\bar{\alpha}_{js} \leq 0$, то решений нет.
\item В качестве вводимой в состав базиса свободной переменной
  $\bar{x}_s$ выбирается та, которой отвечает наибольший положительный
  коэффициент $\bar{\Delta}_s$. Соответствующий столбец называется
  ведущим.
\item Выбор исключаемой из базиса переменной $\bar{x}_r$ производится
  таким образом, что достигается минимум симплексного отношения
  $\Theta = \frac{\bar{\beta}_r}{\bar{\alpha}_{rs}}$ для
  $\bar{\alpha}_{rs} > 0$. Соответствующая строка называется ведущей.
\item Осуществляется переход к новому базису — ведущая строка делится
  на $\bar{\alpha}_{rs}$ и ведущий столбец путём элементарных
  преобразований приводится единичному виду.
\item Процесс повторяется с первого шага для нового базиса
\end{steps}

\begin{rem}
  \label{rem:omitting-free}
  После того, как переменная была исключена из числа базисных,
  дальнейшее её рассмотрение в ходе работы алгоритма не имеет
  практического значения. В представленных далее примерах столбцы
  матрицы \eqref{eq:lp-matrix}, соответствующие исключённым ранее
  переменным, будут опускаться.
\end{rem}

Алгоритм симплекс-метода гарантирует допустимость базисного решения,
получаемого на каждой итерации. При этом проблему может составлять
построение \emph{начального} допустимого базисного решения. Структура
целевой функции и ограничений могут быть таковы, что сразу привести
задачу \eqref{eq:lp-problem-form-initial} к виду
\eqref{eq:lp-problem-form} не удастся. Для этого пользуются различными
методами для поиска начального решения, один из которых — метод
искусственных переменных — изложен в следующем разделе.

\begin{rem}
  \label{rem:slack-solution}
  Задачи линейного программирования, в которых все ограничения имеют
  вид неравенств с ``$\leq$'' с неотрицательной правой частью,
  приводятся к виду \eqref{eq:lp-problem-form} за счёт добавления
  остаточных переменных (см. замечание \ref{rem:slack}), поэтому для
  них начальное допустимое решение получается сразу.
\end{rem}

\subsubsection{Метод искусственных переменных}

В данном методе сначала рассматривается вспомогательная задача,
решение которой затем используется в качестве начального для исходной
задачи. Алгоритм метода имеет следующую схему:

\begin{steps}
\item Пусть все ограничения исходной задачи
  \eqref{eq:lp-problem-form-initial} приведены к виду равенств. Для
  каждого ограничения, в котором не содержится остаточной переменной
  (см. замечание \ref{rem:slack}), вводится искусственная остаточная
  переменная.
\item Решается вспомогательная задача линейного программирования
  \emph{минимизации} суммы $\tilde{f}$ введённых искусственных
  переменных при полученных ограничениях. Если минимальное значение
  новой целевой функции $\tilde{f}$ больше нуля, то исходная задача
  решения не имеет. В противном случае полученное оптимальное решение
  используется в качестве начального допустимого базисного решения в
  исходной задаче.
\end{steps}

\subsubsection{Геометрическая интерпретация}
\label{sec:simplex-geom}

Рассмотрим следующую простую задачу линейного программирования:

\begin{equation}
  \label{eq:lp-simple}
  \begin{cases}
    f(x) = -x_1-2x_2 \to \min \\
    -3x+4y \leq 8 \\
    \phm 7x+6y \leq 35 \\
    \phm x_1, x_2 \geq 0
  \end{cases}
\end{equation}

Проиллюстрируем на ней алгоритм симплекс-метода.

Согласно замечанию \ref{rem:slack} преобразуем ограничения к
равенствам, добавив остаточные переменные, и приведём задачу к виду
\eqref{eq:lp-problem-form}:
\begin{equation*}
  \begin{cases}
    f(x) = -x_1-2x_2 \to \min \\
    -3x+4y+s_1 = 8 \\
    \phm 7x+6y+s_2 = 35 \\
    \phm x_1, x_2, s_1, s_2 \geq 0
  \end{cases}
\end{equation*}
Как и говорилось в замечании \ref{rem:slack-solution}, в данном случае
использование метода искусственных переменных не нужно, так как
начальное допустимое решение находится сразу.

Перейдём к матричному представлению задачи.
\begin{equation*}
  \begin{bmatrix}
     & s_1 & s_2 & x_1 & x_2 & \\
    s_1 & 1 & 0 & \mm3 & 4 & \mathbf{8} \\
    s_2 & 0 & 1 &  7 & 6 & 35 \\
    f & 0 & 0 & 1 & \mathbf{2} & 0
  \end{bmatrix}
\end{equation*}
Максимальный положительный элемент в последней строке соответствует
свободной переменной $x_2$, поэтому её выберем в качестве вводимой.
Минимум соотношения $\Theta = \frac{\bar{\beta}_r}{\bar{\alpha}_{rs}}$
достигается на первой строке (в ней $\Theta = \frac{8}{4} = 2$),
поэтому первая базисная переменная $s_1$ выбирается в качестве
исключаемой. Теперь путём элементарных преобразований приведём ведущий
столбец к единичному виду:
\begin{equation*}
  \begin{gmatrix}[b]
     & s_1 & s_2 & x_1 & x_2 & \\
    s_1 & 1 & 0 & \mm{3} & \mathbf{4} & 8 \\
    s_2 & 0 & 1 &  7 & 6 & 35 \\
    f & 0 & 0 & 1 & 2 & 0
    \rowops
    \add[-\frac{3}{2}]{1}{2}
    \add[-\frac{1}{2}]{1}{3}
    \mult{1}{\mul \frac{1}{4}}
  \end{gmatrix}
\end{equation*}
Таким образом переменная $x_2$ вводится в базис, а $s_1$ — исключается
из него. На следующей итерации матрица задачи имеет вид:
\begin{equation*}
  \begin{bmatrix}
     & s_2 & x_1 & x_2 &  \vspace{1pt}\\
    x_2 & 0 & \mm{\frac{3}{4}} & 1 & 2 \vspace{3pt}\\
    s_2 & 1 & \frac{23}{2} & 0 & \mathbf{23} \vspace{3pt}\\
    f & 0 & \mathbf{\frac{5}{2}} & 0 & \mm{4}
  \end{bmatrix}
\end{equation*}
На этот раз ведущим является второй столбец, соответствующий свободной
переменной $x_1$. Строка базисной переменной $s_1$ является ведущей.
Введём выбранную переменную $x_1$ в состав базисных путём элементарных
преобразований:
\begin{equation*}
  \begin{gmatrix}[b]
     & s_2 & x_1 & x_2 &  \vspace{1pt}\\
    x_2 & 0 & \mm{\frac{3}{4}} & 1 & 2 \vspace{3pt}\\
    s_2 & 1 & \mathbf{\frac{23}{2}} & 0 & 23 \vspace{3pt}\\
    f & 0 & \frac{5}{2} & 0 & \mm{4}
    \rowops
    \add[\frac{3}{46}]{2}{1}
    \add[-\frac{5}{23}]{2}{3}
    \mult{2}{\mul \frac{2}{23}}
  \end{gmatrix}
\end{equation*}

В результате элементы рассматриваемой матрицы приобретут следующие
значения:
\begin{equation*}
  \begin{bmatrix}
     & x_1 & x_2 &  \vspace{1pt}\\
    x_2 & 0 & 1 & \frac{7}{2} \vspace{3pt}\\
    x_1 & 1 & 0 & 2 \vspace{3pt}\\
    f & 0 & 0 & \mm{9}
  \end{bmatrix}
\end{equation*}

Отрицательность всех коэффициентов в последней строке свидетельствует
о том, что найдено оптимальное допустимое решение. Соответствующие
значения базисных переменных находятся в правом столбце матрицы: $x_1
= 2, x_2 = \frac{7}{2}$, свободные переменные приравниваются к нулю.

Рассмотрим выполненные действия с геометрической точки зрения. На
рисунке \ref{fig:simplex-method} изображены линии уровня функции $f(x)
= -x_1-2x_2$, в минимизации которой на заданном множестве
(\ref{plot:simplex-feasible-space}) и состоит задача
\eqref{eq:lp-simple}.

На каждой итерации алгоритм симплекс-метода изменяет значение только
одной небазисной переменной, не нарушая при этом ограничений задачи. В
начальном базисном решении $s_1 = s_2 = 0$, откуда $x_1 = x_2 = 0$,
так что движение начинается из точки начала координат. 

После первой итерации переменная $s_1$ выводится из состава базисных
взамен $x_2$. В найденном базисном решении $x_2 = 2, s_2 = 23$, откуда
$x_1 = 0$, так что метод приходит в точку $(0, 2)$, являющуюся
пересечением границ двух ограничений $-3x_1+4x_2 \leq 8$ и $x_1 \geq
0$.

В результате второй итерации исключается уже переменная $s_2$, и метод
приходит в очередную вершину допустимого множества — $(2, 3.5)$,
которая оказывается оптимальным решением задачи. Действительно, судя
по ориентации линии уровня $9$, проходящей через найденную точку, и
направлению убывания $-f'(x) =
\left(\begin{smallmatrix}1\\2\end{smallmatrix}\right)$
(\ref{plot:antigradient}) целевой функции ясно, что дальнейшее
уменьшение значения функции при наложенных ограничениях невозможно.

\input{simplex-method.tkz.tex}

\clearpage
\subsection{Практический пример}

К решению предлагается следующая задача:
\begin{equation}
  \label{eq:lp-initial}
  \begin{cases}
    f(x) = -3x_1+2x_2-2x_3+2x_4-x_5 \to \min \\
    -x_1+x_2-x_3=1 \\
    -x_2+x_3+x_4=1 \\
    \phm x_2+x_3+x_5=2 \\
    \phm x_i \geq 0,\, i = \overline{1, 5}
  \end{cases}
\end{equation}

Воспользуемся методом искусственных переменных для построения
начального допустимого базисного решения. Добавим в первое ограничение
переменную $x_6$ так, что оно примет вид
\begin{equation*}
  -x_1+x_2-x_3+x_6=1 \\
\end{equation*}

Заменим минимизируемую функцию на $\tilde{f}(x) = x_6$ и выразим её
через свободные переменные $x_1, x_2, x_3$, получив
\mbox{$\tilde{f}(x) = x_1-x_2+x_3+1$}. Перейдём к рассмотрению
вспомогательной задачи
\begin{equation}
  \begin{cases}
    \tilde{f}(x) = x_1-x_2+x_3+1 \to \min \\
    -x_1+x_2-x_3+x_6=1 \\
    -x_2+x_3+x_4=1 \\
    \phm x_2+x_3+x_5=2 \\
    \phm x_i \geq 0,\, i = \overline{1, 6}
  \end{cases}
\end{equation}

Решим её симплекс-методом. Составим расширенную матрицу из
коэффициентов ограничений и целевой функции:
\begin{equation}
  \begin{gmatrix}[b]
     &  x_1 &  x_2 &  x_3 & x_4 & x_5 &
    x_6 & \\
    x_6 & \mm{1} &  1 & \mm{1} & 0 & 0 & 1 & \mathbf{1} \\
    x_4 &  0 & \mm{1} &  1 & 1 & 0 & 0 & 1 \\
    x_5 &  0 &  1 &  1 & 0 & 1 & 0 & 2 \\
    \tilde{f}    & \mm{1} &  \mathbf{1} & \mm{1} & 0 & 0 & 0 & 1
  \end{gmatrix}
\end{equation}

Базисными переменными являются $x_4, x_5, x_6$. Для дальнейшего
решения необходимо исключить искусственную переменную $x_6$ из состава
базисных. 

Выберем в качестве ведущего столбец с максимальным элементом в
последней строке — это столбец переменной $x_2$, поскольку $\max\{1,
-1, 0\} = 1$. С помощью симплексного отношения выберем первую строку в
качестве ведущей.

Учитывая выбранный ведущий элемент, переведём переменную $x_2$ в
состав базисных взамен $x_6$:
\begin{equation*}
  \begin{gmatrix}[b]
     & x_1 & x_2 & x_3 & x_4 & x_5 & x_6 & \\
    x_6 & \mm{1} &  \mathbf{1} &\mm{1}& 0 & 0 & 1 & 1 \\
    x_4 &  0 &\mm{1}&  1 & 1 & 0 & 0 & 1 \\
    x_5 &  0 &  1 &  1 & 0 & 1 & 0 & 2 \\
    \tilde{f} &  1&  1 &\mm{1}& 0 & 0 & 0 & 1
    \rowops
    \add{1}{2}
    \add[-1]{1}{3}
    \add[-1]{1}{4}
  \end{gmatrix}
\end{equation*}

Получим матрицу\footnote{Столбец исключённой переменной опущен,
  см. замечание \ref{rem:omitting-free}.} с базисными переменными $x_2,
x_4, x_5$:
\begin{equation}
  \label{eq:lp-artif}
  \begin{bmatrix}
     & x_1 & x_2 & x_3 & x_4 & x_5 & \\
    x_2 &\mm{1}&  1 &\mm{1}& 0 & 0 & 1\\
    x_4 &\mm{1}&  0 &  0 & 1 & 0 & 2\\
    x_5 &  1 &  0 &  2 & 0 & 1 & 1\\
    \tilde{f} & 0 &  0 & 0 & 0 & 0 & 0
  \end{bmatrix}
\end{equation}

При этом значение функции $\tilde{f}(x)$ равно нулю, что свидетельствует
о том, что найденное решение вспомогательной задачи является
допустимым для исходной.

Отбросим искусственную переменную $x_6$ и вернёмся к начальной задаче
\eqref{eq:lp-initial}. Исключим из исходной целевой функции $f(x)$
базисные переменные $x_2, x_4$ и $x_5$, используя ограничения из
матрицы \eqref{eq:lp-artif}:
\begin{equation*}
  \begin{cases}
    -x_1+x_2-x_3=1\\
    -x_1+x_4=2\\
    \phm x_1+2x_3+x_5 = 1
  \end{cases}
\end{equation*}

Тогда $f(x)$ принимает вид
\begin{equation*}
  f(x) = 2x_1+2x_3+5
\end{equation*}

Используем эту целевую функцию в матрице ограничений \eqref{eq:lp-artif}:
\begin{equation*}
  \begin{bmatrix}
     & x_1 & x_2 & x_3 & x_4 & x_5 & \\
    x_2 &\mm{1}& 1 &\mm{1}& 0 & 0 & 1\\
    x_4 &\mm{1}& 0 &  0 & 1 & 0 & 2\\
    x_5 &  1 & 0 &  2 & 0 & 1 & 1\\
    \tilde{f} & \mm{2} & 0 & \mm{2} & 0 & 0 & 5
  \end{bmatrix}
\end{equation*}

В нижнем ряду под столбцами переменных все коэффициенты отрицательны,
что свидетельствует о том, что найдено оптимальное решение:
\begin{equation*}
  x = (0, 1, 0, 2, 0)
\end{equation*}

